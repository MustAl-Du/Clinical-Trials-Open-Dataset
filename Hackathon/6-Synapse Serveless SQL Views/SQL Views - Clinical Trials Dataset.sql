SELECT TOP 10
    --__rank,
    --overall_status,
    --location,
    JSON_VALUE(location, '$[0].facility.address.country') AS country,
    COUNT(1)
    --JSON_VALUE(location, '$[0].facility.address.city') + ',' + JSON_VALUE(location, '$[1].facility.address.city') AS city,
    --JSON_VALUE(location, '$[0].facility.address.zip') AS zip,
    --JSON_VALUE(sponsors_lead_sponsor, '$.agency') AS sponsors_lead_sponsor_agency,
    --JSON_VALUE(sponsors_lead_sponsor, '$.agency_class') AS sponsors_lead_sponsor_agency_class,
    --'.' AS '.'
FROM OPENROWSET(
        BULK 'https://ataidedl.blob.core.windows.net/ataidefs/SemiFlattenedCleaned2.csv',
        FORMAT = 'csv',
        HEADER_ROW = TRUE,
        FIRST_ROW = 2
    ) WITH (
        __rank NVARCHAR(MAX),
        acronym NVARCHAR(MAX),
        arm_group NVARCHAR(MAX),
        biospec_retention NVARCHAR(MAX),
        brief_title NVARCHAR(MAX),
        condition NVARCHAR(MAX),
        disposition_first_submitted NVARCHAR(MAX),
        disposition_first_submitted_qc NVARCHAR(MAX),
        has_expanded_access NVARCHAR(MAX),
        intervention NVARCHAR(MAX),
        keyword NVARCHAR(MAX),
        last_update_submitted NVARCHAR(MAX),
        last_update_submitted_qc NVARCHAR(MAX),
        link NVARCHAR(MAX),
        location NVARCHAR(MAX),
        number_of_arms NVARCHAR(MAX),
        number_of_groups NVARCHAR(MAX),
        official_title NVARCHAR(MAX),
        other_outcome NVARCHAR(MAX),
        overall_official NVARCHAR(MAX),
        overall_status NVARCHAR(MAX),
        phase NVARCHAR(MAX),
        primary_outcome NVARCHAR(MAX),
        reference NVARCHAR(MAX),
        results_first_submitted NVARCHAR(MAX),
        results_first_submitted_qc NVARCHAR(MAX),
        results_reference NVARCHAR(MAX),
        secondary_outcome NVARCHAR(MAX),
        source NVARCHAR(MAX),
        study_first_submitted NVARCHAR(MAX),
        study_first_submitted_qc NVARCHAR(MAX),
        study_type NVARCHAR(MAX),
        target_duration NVARCHAR(MAX),
        verification_date NVARCHAR(MAX),
        biospec_descr_textblock NVARCHAR(MAX),
        brief_summary_textblock NVARCHAR(MAX),
        clinical_results_baseline NVARCHAR(MAX),
        clinical_results_certain_agreements NVARCHAR(MAX),
        clinical_results_limitations_and_caveats NVARCHAR(MAX),
        clinical_results_outcome_list NVARCHAR(MAX),
        clinical_results_participant_flow NVARCHAR(MAX),
        clinical_results_point_of_contact NVARCHAR(MAX),
        clinical_results_reported_events NVARCHAR(MAX),
        completion_date__VALUE NVARCHAR(MAX),
        completion_date___type NVARCHAR(MAX),
        condition_browse_mesh_term NVARCHAR(MAX),
        detailed_description_textblock NVARCHAR(MAX),
        disposition_first_posted__VALUE NVARCHAR(MAX),
        disposition_first_posted___type NVARCHAR(MAX),
        eligibility_criteria NVARCHAR(MAX),
        eligibility_gender NVARCHAR(MAX),
        eligibility_gender_based NVARCHAR(MAX),
        eligibility_gender_description NVARCHAR(MAX),
        eligibility_healthy_volunteers NVARCHAR(MAX),
        eligibility_maximum_age NVARCHAR(MAX),
        eligibility_minimum_age NVARCHAR(MAX),
        eligibility_sampling_method NVARCHAR(MAX),
        eligibility_study_pop NVARCHAR(MAX),
        enrollment__VALUE NVARCHAR(MAX),
        enrollment___type NVARCHAR(MAX),
        id_info_nct_id NVARCHAR(MAX),
        id_info_org_study_id NVARCHAR(MAX),
        id_info_secondary_id NVARCHAR(MAX),
        intervention_browse_mesh_term NVARCHAR(MAX),
        last_update_posted__VALUE NVARCHAR(MAX),
        last_update_posted___type NVARCHAR(MAX),
        location_countries_country NVARCHAR(MAX),
        oversight_info_has_dmc NVARCHAR(MAX),
        oversight_info_is_fda_regulated_device NVARCHAR(MAX),
        oversight_info_is_fda_regulated_drug NVARCHAR(MAX),
        oversight_info_is_unapproved_device NVARCHAR(MAX),
        oversight_info_is_us_export NVARCHAR(MAX),
        patient_data_ipd_access_criteria NVARCHAR(MAX),
        patient_data_ipd_description NVARCHAR(MAX),
        patient_data_ipd_info_type NVARCHAR(MAX),
        patient_data_ipd_time_frame NVARCHAR(MAX),
        patient_data_ipd_url NVARCHAR(MAX),
        patient_data_sharing_ipd NVARCHAR(MAX),
        pending_results_returned NVARCHAR(MAX),
        pending_results_submission_canceled NVARCHAR(MAX),
        pending_results_submitted NVARCHAR(MAX),
        primary_completion_date__VALUE NVARCHAR(MAX),
        primary_completion_date___type NVARCHAR(MAX),
        provided_document_section_provided_document NVARCHAR(MAX),
        removed_countries_country NVARCHAR(MAX),
        required_header_download_date NVARCHAR(MAX),
        required_header_link_text NVARCHAR(MAX),
        required_header_url NVARCHAR(MAX),
        responsible_party_investigator_affiliation NVARCHAR(MAX),
        responsible_party_investigator_full_name NVARCHAR(MAX),
        responsible_party_investigator_title NVARCHAR(MAX),
        responsible_party_responsible_party_type NVARCHAR(MAX),
        results_first_posted__VALUE NVARCHAR(MAX),
        results_first_posted___type NVARCHAR(MAX),
        sponsors_collaborator NVARCHAR(MAX),
        sponsors_lead_sponsor NVARCHAR(MAX),
        start_date__VALUE NVARCHAR(MAX),
        start_date___type NVARCHAR(MAX),
        study_design_info_allocation NVARCHAR(MAX),
        study_design_info_intervention_model NVARCHAR(MAX),
        study_design_info_intervention_model_description NVARCHAR(MAX),
        study_design_info_masking NVARCHAR(MAX),
        study_design_info_masking_description NVARCHAR(MAX),
        study_design_info_observational_model NVARCHAR(MAX),
        study_design_info_primary_purpose NVARCHAR(MAX),
        study_design_info_time_perspective NVARCHAR(MAX),
        study_docs_study_doc NVARCHAR(MAX),
        study_first_posted__VALUE NVARCHAR(MAX),
        study_first_posted___type NVARCHAR(MAX)
        ) AS ROWS
--WHERE location LIKE '%"city":"F_kuo%'
GROUP BY JSON_VALUE(location, '$[0].facility.address.country')
GO
